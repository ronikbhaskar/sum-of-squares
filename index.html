<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Can you find the right numbers to reach the target? Almost every number can be constructed as a sum of unique squares, but finding the right combination is easier said than done. Share the puzzle with your friends, and see who's smarter.">
  <!-- This concept is mine, based on a conversation I had with a friend, but the code is mostly AI generated with a few human fixes. - Ronik Bhaskar -->
  <title>Sum of Squares</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap');

    html, body {
      height: 100%;
    }

    body {
      margin: 0;
      padding: 16px;
      font-family: 'Orbitron', system-ui, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      background: linear-gradient(180deg, #f7f4ef, #ece6dd);
      color: #1e2233;
    }

    .container {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
    }

    .target {
      font-size: 3rem;
      font-weight: 700;
      margin-bottom: 6px;
    }

    .sum {
      font-size: 1.6rem;
      margin-bottom: 18px;
      color: #c62828;
      transition: color 0.2s ease, transform 0.2s ease;
    }

    .sum.win {
      color: #2e7d32;
      transform: scale(1.15);
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 12px;
      width: 100%;
      max-width: 420px;
    }

    button.num {
      font-family: inherit;
      padding: 18px 0;
      font-size: 1.6rem;
      border-radius: 10px;
      border: none;
      background: linear-gradient(180deg, #ffffff, #efe6d8);
      color: #2b2b2b;
      box-shadow: 0 6px 0 #9aa0b3;
      transition: transform 0.1s ease, box-shadow 0.1s ease, background 0.2s ease;
      touch-action: manipulation;
    }

    button.num:active {
      transform: translateY(3px);
      box-shadow: 0 2px 0 #9aa0b3;
    }

    button.num.selected {
      background: linear-gradient(180deg, #ffcc80, #ffb74d);
      color: #000;
      box-shadow: 0 3px 0 #c88719;
    }

    button.num.win-selected {
      background: linear-gradient(180deg, #a5d6a7, #81c784);
      color: #1b5e20;
      box-shadow: 0 3px 0 #4caf50;
    }

    @keyframes winPulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.15); }
      100% { transform: scale(1); }
    }

    @keyframes screenShake {
      0% { transform: translate(0, 0); }
      20% { transform: translate(-6px, 4px); }
      40% { transform: translate(6px, -4px); }
      60% { transform: translate(-4px, -6px); }
      80% { transform: translate(4px, 6px); }
      100% { transform: translate(0, 0); }
    }

    .winPulse {
      animation: winPulse 0.25s ease-in-out 1;
    }

    .shake {
      animation: screenShake 0.35s ease-in-out 1;
    }

    #shareBtn, #newGameBtn {
      margin-top: 20px;
      padding: 10px 18px;
      font-family: 'Orbitron', system-ui, sans-serif;
      border-radius: 8px;
      border: none;
      background: #ffffff;
      color: #2b2b2b;
      box-shadow: 0 4px 0 #9aa0b3;
      transition: transform 0.1s ease, box-shadow 0.1s ease, background 0.2s ease;
    }

    #shareBtn:active, #newGameBtn:active {
      transform: translateY(2px);
      box-shadow: 0 2px 0 #9aa0b3;
      background: #f0f0f0;
    }

  </style>
</head>
<body>
  <div class="container" id="container">
    <div class="target" id="target"></div>
    <div class="sum" id="sum">0</div>
    <div class="grid" id="grid"></div>
    <div class="controls">
      <button id="shareBtn">Share this Level</button>
      <button id="newGameBtn">New Game</button>
    </div>

  </div>

  <script>
    function randomTarget() {
      return Math.floor(Math.random() * (999 - 129 + 1)) + 129;
    }

    function getTargetFromQuery() {
      const params = new URLSearchParams(window.location.search);
      const t = parseInt(params.get('target'), 10);
      if (!isNaN(t) && t >= 128 && t <= 999) {
        return t;
      }
      return null;
    }

    const queryTarget = getTargetFromQuery();
    const TARGET = queryTarget !== null ? queryTarget : randomTarget();

    const targetEl = document.getElementById('target');
    const sumEl = document.getElementById('sum');
    const gridEl = document.getElementById('grid');
    const containerEl = document.getElementById('container');
    const AudioContext = window.AudioContext || window.webkitAudioContext;
    const audioCtx = new AudioContext();
    const buttonClickSound = new Audio('select-mixkit.wav', preload="auto");
    const winSound = new Audio('win-mixkit.wav', preload="auto");

    targetEl.textContent = TARGET;

    const maxN = Math.floor(Math.sqrt(TARGET));
    let currentSum = 0;
    let hasWon = false;

    function updateSum() {
      sumEl.textContent = currentSum;

      if (currentSum === TARGET && !hasWon) {
        hasWon = true;
        sumEl.classList.add('win', 'winPulse');
        containerEl.classList.add('shake');

        document.querySelectorAll('button.num.selected').forEach(b => {
          b.classList.add('win-selected');
        });

        setTimeout(() => containerEl.classList.remove('shake'), 400);
        winSound.play();
        navigator.vibrate(200);
      }

      if (currentSum !== TARGET) {
        hasWon = false;
        sumEl.classList.remove('win', 'winPulse');
        document.querySelectorAll('button.num.win-selected').forEach(b => {
          b.classList.remove('win-selected');
        });
      }
    }

    for (let i = 1; i <= maxN; i++) {
      const btn = document.createElement('button');
      btn.className = 'num';
      btn.textContent = i;

      btn.addEventListener('click', () => {
        const value = i * i;
        buttonClickSound.currentTime = 0;
        buttonClickSound.play();

        if (btn.classList.contains('selected')) {
          btn.classList.remove('selected');
          currentSum -= value;
        } else {
          btn.classList.add('selected');
          currentSum += value;
        }

        updateSum();
      });

      gridEl.appendChild(btn);
    }

    const shareBtn = document.getElementById('shareBtn');
    const newGameBtn = document.getElementById('newGameBtn');

    shareBtn.addEventListener('click', async () => {
      buttonClickSound.currentTime = 0;
      buttonClickSound.play();
      const url = `${window.location.origin}${window.location.pathname}?target=${TARGET}`;
      try {
        await navigator.clipboard.writeText(url);
        shareBtn.textContent = 'Copied!';
        setTimeout(() => (shareBtn.textContent = 'Share this Level'), 1200);
      } catch (e) {
        alert(url);
      }
    });

    newGameBtn.addEventListener('click', () => {
      buttonClickSound.currentTime = 0;
      buttonClickSound.play();
      const cleanUrl = `${window.location.origin}${window.location.pathname}`;
      window.location.href = cleanUrl;
    });


    updateSum();
  </script>
</body>
</html>
